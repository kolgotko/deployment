var repo = require('Repo');
var pwuid = require('pwuid');

try{
	var config = JSON.parse(require('fs').readFileSync(__dirname+'/../config.json'));
	repo.__proto__ = config;
	process.env.LANG='en_US.UTF-8';
	config.group && process.setgid(config.group);
	config.user && process.setuid(config.user);
	config.umask && process.umask(config.umask);
	process.env.HOME=config.home;
	process.argv.indexOf('-d')!=-1 ?
	[
		child=require('child_process').spawn(
			__dirname+'/../bin/www',
			[],
			{
				cwd:'/',
				stdio:'ignore',
				detached:true,
				uid:process.getuid(),
				gid:process.getgid()
			}
		),
		console.log(child.pid),
		child.unref(),
		process.exit(0)
	] : process.chdir(__dirname+'/../');
}
catch(e){console.log(e);}

module.exports = config;
